import{j as r,k as i,l,m as o}from"./index.69f64e29.js";import{u as a,a as n,b as g}from"./user.cca4b6e2.js";const f=r({id:"login",state:()=>({ruleFormRef:i(),ruleForm:{pass:"",user:""},rules:{pass:[{validator:(s,e,t)=>{e===""?t(new Error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF01\uFF01")):e.length<6?t(new Error("\u5BC6\u7801\u5FC5\u987B\u5927\u4E8E\u6216\u7B49\u4E8E6\uFF01\uFF01")):t()},trigger:"blur"}],user:[{validator:(s,e,t)=>{e===""?t(new Error("\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A\uFF01\uFF01")):/^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]{8}$/.test(e)?t():t(new Error("\u7528\u6237\u540D\u5FC5\u987B\u662F\u624B\u673A\u53F7\uFF01\uFF01"))},trigger:"blur"}]},loginLoading:!1,router:l(),loginStatus:localStorage.getItem("loginStatus"),userInfo:JSON.parse(localStorage.getItem("userInfo")||"{}")}),actions:{init(){this.ruleForm={pass:"",user:""}},login(s){!s||(this.loginLoading=!1,s.validate(e=>{if(e){this.loginLoading=!0;let{user:t,pass:u}=this.ruleForm;this.loginAsync(t,u),console.log("\u5DF2\u63D0\u4EA4")}else return this.loginLoading=!1,console.log("\u6821\u9A8C\u9519\u8BEF"),!1}))},loginAsync(s,e){this.loginLoading=!1,a(s,e).then(t=>{console.log(t),t.code===200?(this.getUserDetail(t.profile.userId),localStorage.setItem("cookie",t.cookie),localStorage.setItem("token",t.token),localStorage.setItem("loginStatus","1"),this.loginStatus="1"):o({type:"error",message:t.msg})}).catch(()=>{o({type:"error",message:"\u4F3C\u4E4E\u51FA\u4E86\u4EC0\u4E48\u95EE\u9898\u554A\uFF0C\u5567\u5567\u5567!!!"})})},async handleCommand(s){switch(s){case"personal":this.router.push({name:"personal"});break;case"logout":var e=await n();e.code===200&&(this.router.push({name:"login"}),this.loginStatus="",localStorage.setItem("loginStatus",""),localStorage.setItem("token",""),localStorage.setItem("userInfo","{}"),this.userInfo={});break}},async getUserDetail(s){try{let e=await g(s);if(e.code===200){let t={...e.profile,level:e.level,listenSongs:e.listenSongs,createTime:e.createTime,createDays:e.createDays};localStorage.setItem("userInfo",JSON.stringify(t)),this.userInfo=t,o({type:"success",message:"\u767B\u5F55\u6210\u529F"}),setTimeout(()=>{this.loginLoading=!1,this.router.go(-1)},1500)}}catch(e){console.log(e)}},isEmpty(s){return s==null||typeof s=="object"&&Object.keys(s).length===0||typeof s=="string"&&s.trim().length===0}}});export{f as u};
